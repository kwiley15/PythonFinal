{% load static %}
<!--load static files like css-->
<!DOCTYPE html>
<html lang="en">

<head>
    <!--set character encoding for the page -->
    <meta charset="UTF-8">
    <!--make the page responsive on different decvices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Netflix Content</title><!--Title-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><!--link to bootstrap-->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}"><!--link to CSS-->
</head>

<body>

{% include 'dashboard/navbar.html' %}
<!--load navbard from navbar.html-->
<div class="container mt-4">
    <h1>Search Netflix Content</h1>
    <!--title for the page-->

    <!-- Search & Filters -->
    <form method="get" class="filter-box mb-4">

        <input type="text" class="form-control mb-3" name="q"
            placeholder="Search by title, director, cast" 
            value="{{ query }}">
            <!--text input for searching by title, director, cast-->
            <!--populate with previous query (if there is one)-->


        <!-- Genres checkbox filters -->
        <div class="mb-3">
            <strong>Genres:</strong><br>
            {% for g in genre_options %}
            <!--loop through each genre and create a checkbox (not populated from database)-->
                <label class="me-2">
                    <input type="checkbox" name="listed_in" value="{{ g }}"
                        {% if g in selected_genres %}checked{% endif %}> {{ g }} <!--check box if genre is selected -->
                </label>
            {% endfor %} 
            <!--end for loop -->
        </div>

        <!-- dropdown Year / Country / Sort -->
        <div class="row">
            <!--year filter-->
            <div class="col-md-3">
                <select name="year" class="form-select mb-3">
                    <option value="">All Years</option> <!--default option, shows all years if none is selected -->
                    <!--Loop through all available years from the backend-->
                    {% for y in years %}
                    <!--create an option for each year in database-->
                        <option value="{{ y }}"
                            {% if y|stringformat:"s" == year_filter|stringformat:"s" %}selected{% endif %}>
                            {{ y }} <!--Display the year-->
                        </option>
                    {% endfor %} <!--end for loop-->
                </select>
            </div>

            <!--Country filter-->
            <div class="col-md-3">
                <select name="country" class="form-select mb-3"> <!--deafult options shows all if none is selected-->
                    <option value="">All Countries</option>
                    <!--loop through all the countries in the backend -->
                    {% for c in countries %}
                    <!--create an option for each country -->
                        <option value="{{ c }}" {% if c == country_filter %}selected{% endif %}>
                            {{ c }} <!--display country name-->
                        </option>
                    {% endfor %} <!--end for loop -->
                </select>
            </div>

            <!--sort filter -->
            <div class="col-md-3">
                <select name="sort" class="form-select mb-3">
                    <!--sort options -->
                    <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>Newest First</option> 
                    <option value="oldest" {% if sort_by == 'oldest' %}selected{% endif %}>Oldest First</option>
                    <option value="a-z" {% if sort_by == 'a-z' %}selected{% endif %}>A - Z</option>
                    <option value="z-a" {% if sort_by == 'z-a' %}selected{% endif %}>Z - A</option>
                </select>
            </div>
        </div>

        <button type="submit" class="btn btn-netflix me-2">Search</button><!--search button-->
        <a href="{% url 'search' %}" class="btn btn-outline-light">Clear Filters</a> <!--clear all filters button -->
    </form>

    <!-- RESULTS LIST -->
    <ul class="list-group mb-3">
        {% for title in page_obj %}
        <!--display each netflix title as a list item-->
            <li class="list-group-item">
                <strong>{{ title.title }}</strong> ({{ title.release_year }})
                — {{ title.listed_in }} — {{ title.country }}
            </li><!--shows the selected search to return -->
        {% empty %}
        <!--show if no search results are found-->
            <li class="list-group-item">No results found.</li>
        {% endfor %}<!--end for loop-->
    </ul>

    <!-- PAGINATION -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mt-3">
            <!--frist and previous page links -->
            {% if page_obj.has_previous %}
            <!--check if the current paginated page has a previous page, if yes the controls for first and previous will be displayed-->
                <li class="page-item">
                    <!--link to first page while preserving filters -->
                    <a class="page-link"
                       href="?page=1{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                        First
                    </a>
                </li>
                <li class="page-item">
                    <!-- link to previous page while preserving filters-->
                    <a class="page-link"
                       href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                        Previous
                    </a>
                </li>
            {% endif %} <!--end if loop-->
            
            <!--loop through all pages available in the paginator-->
            {% for num in page_obj.paginator.page_range %}
            <!--for loop to show 2 pages before and 2 pages after current page -->
                {% if num >= page_obj.number|add:'-2' and num <= page_obj.number|add:'2' %}
                <!--if current loop number equals the current page-->
                    {% if page_obj.number == num %}
                        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                        <!--highlight page as active and disable clicking -->
                    {% else %}
                    <!--else this is a clickable page number link-->
                        <li class="page-item">
                            <a class="page-link"
                               href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                                {{ num }}<!--selected filters included in url so results stay filtered when changing pages -->
                                <!--append each filter except page-->
                                <!--show the page number -->
                            </a>
                        </li>
                    {% endif %}
                    <!--end check for active page-->
                {% endif %}
                <!--end range check condition-->
            {% endfor %}
            <!--end pagination loop -->

            {% if page_obj.has_next %}
            <!--check if there is a next page available -->
                <li class="page-item">
                    <!--link to the next page-->
                    <a class="page-link"
                       href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                        Next
                    </a> <!--keep filters applied -->
                </li>
                <!--link to the very last page -->
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ page_obj.paginator.num_pages }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                        Last
                    </a><!--keep filters applied-->
                </li>
            {% endif %}
            <!--end has next check -->
        </ul><!--end pagination list -->
    </nav><!--end navigation block-->
</div><!--end container--> 

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script><!--link to bootstrap-->
</body>
</html>
